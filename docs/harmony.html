<!DOCTYPE html><html><head><title>Trial / Audio Output with Harmony</title><meta property="og:image" content="https://repository-images.githubusercontent.com/54314855/81c55af6-b2c4-45f0-b66d-f29fdd37be7f"><meta property="og:image:alt" content="Harmony is an independent audio server system. It is capable of creating complex audio routing systems and also provides a variety of audio effects, outputs, and inputs out of the box. Please see its documentation for more details. In this section we briefly outline how the integration system trial-harmony can help you bridge the gap with Trial."><meta property="og:type" content="object"><meta property="og:title" content="Trial / Audio Output with Harmony"><meta property="og:url" content="https://shirakumo.org/docs/trial/harmony.mess.html"><meta property="og:description" content="Harmony is an independent audio server system. It is capable of creating complex audio routing systems and also provides a variety of audio effects, outputs, and inputs out of the box. Please see its documentation for more details. In this section we briefly outline how the integration system trial-harmony can help you bridge the gap with Trial."></head><body><article><a class="index" href="index.html">Index</a><style>article{max-width:800px;font-size:12pt;font-family:sans-serif;margin:0 auto 3em auto;}article h1{text-align:center;font-size:2em;}article img{margin:0 auto;max-width:100%;}article blockquote{border-left:0.2em solid gray;margin-left:1em;padding-left:1em;}article figcaption{padding:0.2em 1em;background:#E0E0E0;}article code{background:#F0F0F0;padding:0 0.1em;}article .code-block{padding:0.1em 0.5em;overflow-x:auto;}article a.index{display:block;text-decoration:none;text-align:center;font-size:1.1em;background:#151515;border:2px solid #151515;color:#FEFEFE;}article a.index:hover{background:#FEFEFE;color:#151515;}</style><h1 id="audio output with harmony">Audio Output with Harmony</h1><p><a class="external-link" href="https://shirakumo.org/projects/harmony">Harmony</a> is an independent audio server system. It is capable of creating complex audio routing systems and also provides a variety of audio effects, outputs, and inputs out of the box. Please see its documentation for more details. In this section we briefly outline how the integration system <code>trial-harmony</code> can help you bridge the gap with Trial.</p><p>First, you will want to inherit from <code>org.shirakumo.fraf.trial.harmony:settings-main</code>. This <code>main</code> subclass will take care of initializing and finalizing the audio server when the game is started up, and will also automatically interpret the audio-related <a class="external-link" href="settings.html">settings</a>. If you would like to customise how the server builds its pipeline or provide other customisations outside the settings, you can do so with <code>server-initargs</code>:</p><code style="display:block" class="code-block" data-language="common lisp"><pre>(defmethod org.shirakumo.fraf.trial.harmony:server-initargs append ((main main))
  '(:effects ((mixed:biquad-filter :filter :lowpass :name :lowpass))))</pre></code><p>See <code>harmony:make-simple-server</code> for more information on accepted initargs.</p><p>Second, you will want to pre-load sound files. The <code>trial-harmony</code> system provides assets and resources to encapsulate the Harmony objects you need to manage. To import sounds and simple music tracks, use the <code>org.shirakumo.fraf.trial.harmony:sound</code> to define your assets:</p><code style="display:block" class="code-block" data-language="common lisp"><pre>(define-asset (my-pool my-sound) audio-file
  #p&quot;sound.mp3&quot;)</pre></code><p>You can also use <code>sound-bank</code> and input a number of effect files. When playing the sound, Trial will then randomly pick between one of the sounds, which helps avoid repetition. If you want to use Harmony's environments system to do horizontal mixing, define the environment using the <code>org.shirakumo.fraf.trial.harmony:environment</code> asset.</p><p>Before a sound can be played, it must be &quot;staged&quot;. It is sufficient to associate <code>stage</code> with any entity present in the associated scene:</p><code style="display:block" class="code-block" data-language="common lisp"><pre>(defmethod stage :after ((my-entity my-entity) (area staging-area))
  (stage (// 'my-pool 'my-sound) area))</pre></code><p>Finally, in order to play back the sound, just access its resource and call <code>play</code>:</p><code style="display:block" class="code-block" data-language="common lisp"><pre>(org.shirakumo.fraf.harmony:play (// 'my-project 'sound))</pre></code><p>Note that each asset generates exactly <em>one</em> <code>voice</code> instance. You thus cannot play the same sound twice at the same time. Usually this is not an issue, as you can pass <code>:reset T</code> to <code>play</code> to restart the effect instead. In the rare cases where it is vital that the sound effect be played back multiple times simultaneously, you can either define the same sound as multiple assets, or use <code>close</code> before playing it back.</p></article></body></html><link rel="stylesheet" href="highlight-lisp.css"><script type="text/javascript" src="highlight-lisp.js"></script><script type="text/javascript">[...document.querySelectorAll('[data-language="common lisp"] pre')].map(HighlightLisp.highlight_element);</script>